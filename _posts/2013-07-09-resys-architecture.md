---
layout: blog
title: 推荐系统架构
category: tech
excerpt: 淘宝推荐系统从零到现在，完整的系统架构
---

2010年下半年，到2013年初，两年多时间一直都在做推荐系统，现在告一段落了，便决定写个小结。也算是对两年来工作成果的一个总结。  

推荐系统这个话题最近两年狠狠的火了一把，相关资料网上搜索一下也是一大把了，推荐相关的书籍也面世了。  

本人身为一个JAVA工程师，重点关注推荐系统的架构。
主要考虑系统的架构如何能够适应业务的快速发展，如何支持算法的快速迭代，如何管理和维护大量的算法，如何支持分桶ABTest以及效果分析等等。  
而非推荐算法的设计。  
如果你关心协同过滤啊，聚类分类啊，支持度置信度什么的，那便让你失望了。  

推荐系统整体架构图，如下所示：  
<img src="/assets/images/articles/2013-07-09-resys-architecture.png"/>  
推荐系统可以分为4个子系统，分别是：  
####1.zeus 分布式调度系统，所有的推荐算法都存放在调度中心  
####2.treasure 高性能KV服务器  
####3.推荐前台  
####4.可视化管理后台  
图中的箭头和序号，代表的就是推荐系统的数据流转方向  

整个推荐系统有2处依赖放  
1.云梯  
云梯是Hadoop集群，推荐系统的原始数据都存放在云梯上，同时云梯也是一个分布式计算中心，所有的推荐算法都在云梯上进行计算。  
2.埋点系统  
推荐系统的产出结果，需要收集用户反馈。埋点系统是用户行为的收集中心。  
此处的埋点系统兄弟部门已经有现成的了，因此推荐系统没有另起一套，而是依赖了兄弟部门的埋点系统  

***

由图中的数据流向可以看出，整个推荐系统的数据流动是一个闭环。  
步骤1：原始数据的算法加工  
所有的推荐算法都存放在zeus调度系统中  
调度系统启动算法，对原始数据进行计算，产出结果数据。  

步骤2：结果数据导入treasure服务器  
算法产出的数据以KV的格式导入treasure系统，对外提供高速KV查询服务器  

步骤3：推荐前台查询treasure数据  
推荐前台根据不同的业务场景和逻辑，查询相关的treasure数据，计算出推荐结果  

步骤4：推荐系统将推荐结果产出给用户  
推荐系统对外开放推荐API，根据输入条件，返回推荐结果  

步骤5：用户反馈收集  
推荐结果展示给用户后，需要收集用户的点击行为  
通过埋点系统来收集用户行为  

步骤6：用户反馈数据回流推荐系统  
将用户反馈数据回流到推荐系统，并以可视化的界面做呈现  
能够直观的看到各个场景的推荐效果  

步骤7：推荐效果反作用与推荐算法  
此步骤是唯一的一个人工步骤，由算法工程师介入  
算法工程师观测推荐算法的效果，用迭代的方式不断改进算法，以使推荐效果更上一层楼  

整个推荐系统的闭环，就像一个小小的生态系统  
推荐系统的良好架构，使得这个生态系统能够通过迭代，不断优化自身的算法。起到良性循环的作用。    

后续将会对各个子系统进行介绍  
